<?php

use Hypermage\ComponentCustomerHeader\ViewModel\Header as ViewModelHeader;
use Hypermage\Core\ViewModel\Htmx;
use Magento\Framework\Escaper;
use Magento\Theme\Block\Html\Header;

/** @var Header $block */
/** @var Escaper $escaper */

/** @var ViewModelHeader $viewModel */
$viewModel = $block->getViewModel();

/** @var Htmx $htmx */
$htmx = $block->getHtmx();

$hxParams = $htmx->getHxParams($block);
$hxParams->setSwap('outerHTML');

$customer = null;

if ($htmx->isHtmxRequest()) {
    $customer = $viewModel->getCustomerData();
} else {
    $hxParams->addTrigger('load');
}


$welcomeMessage = $block->getWelcome();
?>

<?php if ($block->getShowPart() == 'welcome'): ?>
    <li class="greet welcome" <?= $hxParams ?>>
        <?php if ($customer?->getId()): ?>
            <span class="logged-in">
                <?= $escaper->escapeHtml(__('Welcome, %1!', $customer->getName())) ?>
            </span>
        <?php else: ?>
            <span class="not-logged-in">
                <?= $escaper->escapeHtml($welcomeMessage) ?>
            </span>
            <?= $block->getBlockHtml('header.additional') ?>
        <?php endif; ?>
    </li>
<?php elseif ($block->getShowPart() == 'other'): ?>
    <?= $block->getChildHtml() ?>
<?php endif ?>
